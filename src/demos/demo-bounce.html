<html>
    <head>
        <title>DEMO</title>
    </head>
    <body>
        <canvas id=c width=640 height=480 />

        <script type="text/javascript" src="../yepnope.1.0.2-min.js"></script>
        <script type="text/javascript" src="../playnow/playnow.js"></script>
        <script type="text/javascript">
            now.load([], function(){
                function BouncingBallScene(R, D) {
                    var dot, color;

                    this.add(new Momentum());
                    this.add(new Force(new V(0, 9.8)));
                    this.add(new Bounds());

                    function spawn() {
                        for (var i=0; i<D; i++) {
                            color = [Math.random(), Math.random(), Math.random(), Math.random() / 1.5];
                            dot = new Entity({
                                'position': new V(320, 480)
                            ,   'velocity': new V(Math.random()*R-R/2, Math.random()*R-400)
                            ,   'weight': 0.0
                            ,   'bounce': Math.random()*0.5 + 0.05
                            ,   'rotation': Math.random() * Math.PI / 100
                            ,   'rotation-velocity': Math.random() * Math.PI - Math.PI/2 / 100
                            ,   'color': color 
                            ,   'scale': 0.2 + Math.random()
                            });
                            (function(scene, dot){
                                setTimeout(function(){
                                    if (scene.entities.length > D*10) {
                                        scene.entities.splice(0, 1);
                                    }
                                    scene.add(dot);
                                }, Math.random()*1000);
                            })(this, dot);
                        }
                    }
                    setInterval(
                        (function(scene){
                            return function() {
                                spawn.call(scene);
                            }
                        })(this) 
                    , 1000);

                    this.set('clearEachFrame', [0, 0, 0, 1]);
                }
                BouncingBallScene.prototype = new Scene();

                var viewport = new ViewPort('c');
                var scene = new BouncingBallScene(100, 200);
                viewport.set('scene', scene);
            });
        </script>
    </body>
</html>
