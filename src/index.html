<html>
    <head>
        <title>DEMO</title>
    </head>
    <body>
        <canvas id=c width=640 height=480 />
        <script type="text/javascript" src="entity.js"></script>
        <script type="text/javascript">
            var ctx = document.getElementById('c').getContext('2d');

            var dot = new Entity({
                'position': new V(20, 20)
            ,   'velocity': new V(50, 0)
            ,   'weight': 0.0
            });

            var renderer = new Behavior('position');
            renderer.bind('entitytick', function(e, t, entity) {
                var position = entity.get('position');
                ctx.fillStyle = "red";
                ctx.fillRect(position[0] - 2, position[1] -2, 4, 4);
            });
            renderer.bind('beforetick', function() {
                ctx.fillStyle = 'rgba(255, 255, 255, 0.01)';
                ctx.fillRect(0, 0, 640, 480);
            });

            var gravity = new Behavior('weight velocity');
            gravity.bind('entitytick', function(e, t, entity, update) {
                update({
                    'velocity': entity.get('velocity').add(new V(0, 9.8))
                });
            });

            var momentum = new Behavior('position velocity');
            momentum.bind('entitytick', function(e, t, entity, update) {
                var v = entity.get('velocity');
                update({
                    'position': entity.get('position').add(v.multiply(t))
                });
            });

            var friction = new Behavior('velocity');
            friction.bind('entitytick', function(e, t, entity) {
                var velocity = entity.get('velocity');
                velocity[0] *= 0.9;
                velocity[1] *= 0.9;
                return {
                    'velocity': velocity
                }
            })

            var scene = new Scene();
            scene.add(momentum, gravity, renderer);
            scene.add(dot);

            scene.run();

            setInterval(function() {
                var dot = new Entity({
                    'position': new V(Math.random()*20, 100 + Math.random()*20)
                ,   'velocity': new V(Math.random()*500, Math.random()*-250)
                ,   'weight': 0.0
                });
                scene.add(dot);
            }, 1000);
        </script>
    </body>
</html>
